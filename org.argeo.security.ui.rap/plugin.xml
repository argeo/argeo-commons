<?xml version="1.0" encoding="UTF-8"?>
<?eclipse version="3.4"?>
<plugin>
   <extension
         point="org.eclipse.rap.ui.entrypoint">
      <entrypoint
            id="org.argeo.security.ui.rap.secureEntryPoint"
            class="org.argeo.security.ui.rap.SecureEntryPoint"
            path="/node"
            brandingId="org.argeo.security.ui.rap.defaultBranding">
      </entrypoint>
      <entrypoint
            id="org.argeo.security.ui.rap.anonymousEntryPoint"
            class="org.argeo.security.ui.rap.AnonymousEntryPoint"
            path="/public"
            brandingId="org.argeo.security.ui.rap.defaultBranding">
      </entrypoint>
      <entrypoint
            brandingId="org.argeo.security.ui.rap.defaultBranding"
            class="org.argeo.security.ui.rap.RapLoginEntryPoint"
            id="org.argeo.security.ui.rap.secureEntryPoint"
            path="/login">
      </entrypoint>
   </extension>

	<!-- COMMANDS --> 
	<extension point="org.eclipse.ui.commands">
		<command
			id="org.argeo.security.ui.rap.mainMenuCommand"
			defaultHandler="org.argeo.security.ui.rap.commands.OpenHome"
			name="Main"> 
		</command>
		<command
			id="org.argeo.security.ui.rap.openChangePasswordDialog"
			defaultHandler="org.argeo.eclipse.spring.SpringCommandHandler"
			name="Change Password">
		</command>
		<!-- Enable an "open file" action in a single sourced application  -->  
		<command
			defaultHandler="org.argeo.eclipse.spring.SpringExtensionFactory"
			id="org.argeo.security.ui.specific.openFile"
			name="OpenFile">
			<commandParameter
         		id="param.fileName"
         		name="The name of the file to open (optional)">
  	 		</commandParameter>
            <commandParameter
         		id="param.fileURI"
         		name="The URI of this file on the server">
  	 		</commandParameter>
  	 		<commandParameter
         		id="param.filePath"
         		name="The absolute path of this file on the server file system">
  	 		</commandParameter>
		</command>
 	</extension>

	<!-- MENUS --> 
	<extension point="org.eclipse.ui.menus">
    	<!-- Main tool bar menu -->
    	<menuContribution locationURI="toolbar:org.eclipse.ui.main.toolbar">
        	<toolbar id="org.argeo.security.ui.rap.userToolbar">
				<command
					commandId="org.argeo.security.ui.rap.mainMenuCommand"
					icon="icons/home.gif"
					id="org.argeo.security.ui.rap.mainMenu"
					style="pulldown">
				</command>
				<command commandId="org.eclipse.ui.file.save"/>
				<command commandId="org.eclipse.ui.file.saveAll"/>
			</toolbar>
		</menuContribution>
		
		<!-- User drop down default menu -->
		<menuContribution locationURI="menu:org.argeo.security.ui.rap.mainMenu">
			<!-- Managed programmatically in the RapActionBarAdvisor to enable 
			     the display of the current logged-in user id -->
			<command
				commandId="org.argeo.security.ui.rap.userMenuCommand"
				icon="icons/main.gif"
				id="org.argeo.security.ui.rap.userMenu">
			</command>
			<!-- Still unused
			<command
				commandId="org.eclipse.ui.window.preferences"
				icon="icons/preferences.png"/> -->
        	<command
				commandId="org.argeo.security.ui.rap.openChangePasswordDialog"
				icon="icons/password.gif"
				label="Change password"/>
			<separator
				name="org.argeo.security.ui.rap.beforeFile"
				visible="true">
			</separator>
			<command
				commandId="org.eclipse.ui.file.closeAll"
				icon="icons/closeAll.gif"/>
			<command commandId="org.eclipse.ui.file.save"/>
			<command commandId="org.eclipse.ui.file.saveAll"/>
	
			<!--<command commandId="org.eclipse.ui.views.showView"/>-->
    		<!--<command commandId="org.eclipse.ui.perspectives.showPerspective"/>-->
	
			<separator
				name="org.argeo.security.ui.rap.beforeExit"
				visible="true">
			</separator>
			<command commandId="org.eclipse.ui.file.exit" icon="icons/exit.png"/>
		</menuContribution>
	</extension>
		
    <!-- SERVICE HANDLERS --> 
	<extension point="org.eclipse.rap.ui.serviceHandler">
		<!-- Rap specific service handler to enable file download over the internet-->
		<serviceHandler
			class="org.argeo.eclipse.ui.specific.OpenFileService"
			id="org.argeo.security.ui.specific.openFileService">
		</serviceHandler>
	</extension>
    
    <!-- ACTIVITIES -->
  	<extension
           point="org.eclipse.ui.activities">
        <activity
              description="Anonymous"
              id="org.argeo.security.ui.rap.anonymousActivity"
              name="Anonymous">
		  <enabledWhen>
		    <with variable="roles">
		      <iterate ifEmpty="false" operator="or">
		        <equals value="cn=anonymous,ou=roles,ou=node" />
		      </iterate>
		    </with>
		  </enabledWhen>
        </activity>
        <activity
              description="Not anonymous"
              id="org.argeo.security.ui.rap.notAnonymousActivity"
              name="NotAnonymous">
		  <enabledWhen>
		  	<not>
		    <with variable="roles">
		      <iterate ifEmpty="false" operator="or">
		        <equals value="cn=anonymous,ou=roles,ou=node" />
		      </iterate>
		    </with>
		    </not>
		  </enabledWhen>
        </activity>
		<activityPatternBinding
              activityId="org.argeo.security.ui.rap.notAnonymousActivity"
              pattern="org.argeo.security.ui.rap/org.argeo.security.ui.rap.userMenuCommand"/>         <activityPatternBinding
              activityId="org.argeo.security.ui.rap.notAnonymousActivity"
              pattern="org.argeo.security.ui.rap/org.eclipse.ui.window.preferences"/>
        <activityPatternBinding
              activityId="org.argeo.security.ui.rap.notAnonymousActivity"
              pattern="org.argeo.security.ui.rap/org.argeo.security.ui.rap.openChangePasswordDialog"/>
     </extension>
    
    <!-- BRANDINGS --> 
     <extension
         point="org.eclipse.rap.ui.branding">
    	<branding
			id="org.argeo.security.ui.rap.defaultBranding"
            themeId="org.eclipse.rap.rwt.theme.Default"
            title="Argeo Web UI"
            favicon="branding/favicon.ico">
      	</branding>
      	<!-- we need a servlet with this name j_spring_security_logout
      		 for the logout filter -->
    	<branding
			id="org.argeo.security.ui.rap.logoutBranding"
            title="Argeo Logout"
            favicon="branding/favicon.ico"
            body="branding/empty.html">
      	</branding>
   	</extension>
</plugin>
