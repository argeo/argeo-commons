#!/bin/sh

container=$(buildah from argeo2-tp)

source "$(dirname "$0")/buildah-common"

buildah config --label release="1" $container
buildah config --label version="$VERSION" $container

# Metadata
buildah config --label name="argeo2-openjdk11-ubi8" $container
buildah config --label summary="Argeo 2 Node based on OpenJDK 11 and Red Hat UBI 8" $container

# Required as long as we declare an 'argeo' user
buildah run $container -- microdnf install shadow-utils

# Argeo Node
buildah run $container -- microdnf install argeo-cms-e4-rap argeo-node

# Configuration
buildah config --entrypoint '["/usr/sbin/argeoctl","start"]' $container
buildah config --port 8080 $container

buildah commit $container argeo2-node:latest
